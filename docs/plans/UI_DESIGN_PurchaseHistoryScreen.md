# UI 디자인: PurchaseHistoryScreen (최근 구매 내역 화면)

## 1. 화면 목적 및 사용자 시나리오

### 목적
- 소비자가 완료된 거래(picked_up = true) 내역을 한눈에 확인할 수 있는 전용 화면
- MyPageScreen의 "최근 구매 내역 > 전체보기" 클릭 시 이동

### 사용자 시나리오
1. 사용자가 마이페이지에서 "전체보기" 클릭
2. PurchaseHistoryScreen으로 이동
3. 픽업 완료된 모든 거래 내역 확인
4. 특정 항목 클릭 시 해당 업체 상세페이지로 이동 가능
5. 리뷰 미작성 건은 "리뷰 작성" 버튼 표시

---

## 2. 레이아웃 구조

```
+--------------------------------------------------+
|  [<-]        최근 구매 내역                        |  (헤더)
+--------------------------------------------------+
|  총 N건의 구매 내역                                |  (요약)
+--------------------------------------------------+
|  +--------------------------------------------+  |
|  | [이미지]  업체명                   3일전    |  |
|  |          상품명 x수량                      |  |
|  |          10,000원                         |  |
|  |          [리뷰 작성] (리뷰 없을 때)        |  |
|  +--------------------------------------------+  |
|                                                  |
|  +--------------------------------------------+  |
|  | [이미지]  업체명                   1주전    |  |
|  |          상품명 x수량                      |  |
|  |          15,000원                         |  |
|  |          [리뷰 완료]  (리뷰 있을 때)        |  |
|  +--------------------------------------------+  |
|                                                  |
|  ... (무한 스크롤 또는 페이지네이션)               |
+--------------------------------------------------+
```

---

## 3. 컴포넌트 명세

### 3.1 헤더 (Header)
| 요소 | 설명 |
|------|------|
| 뒤로가기 버튼 | 좌측, 아이콘 "<-" |
| 타이틀 | 중앙, "최근 구매 내역" |

### 3.2 요약 섹션 (Summary)
| 요소 | 설명 |
|------|------|
| 텍스트 | "총 N건의 구매 내역" |
| 스타일 | 배경 #F5F5F5, 패딩 16px |

### 3.3 구매 내역 카드 (PurchaseCard)
| 요소 | 설명 |
|------|------|
| 썸네일 | 60x60, borderRadius 8, 업체 이미지 또는 기본 아이콘 |
| 업체명 | 클릭 가능, 파란색 링크 스타일 (상세페이지 이동) |
| 상품명 | "상품명 x수량" 형식 |
| 금액 | 굵은 글씨, 초록색 (#00D563) |
| 날짜 | 우측 상단, 상대 시간 (N일전) |
| 리뷰 버튼 | 리뷰 미작성 시 "리뷰 작성", 작성 완료 시 "리뷰 완료" (비활성) |

---

## 4. 색상/폰트/간격 스펙

### 색상
```javascript
const colors = {
  primary: '#00D563',      // 브랜드 메인 (금액, 활성 버튼)
  secondary: '#1A1A2E',    // 타이틀
  text: '#333333',         // 본문
  textMuted: '#999999',    // 보조 텍스트
  background: '#F5F5F5',   // 배경
  surface: '#FFFFFF',      // 카드 배경
  link: '#007AFF',         // 링크 (업체명)
  success: '#00A84D',      // 성공 상태
  disabled: '#CCCCCC',     // 비활성
};
```

### 폰트 크기
| 요소 | 크기 | 굵기 |
|------|------|------|
| 헤더 타이틀 | 18px | bold |
| 요약 텍스트 | 14px | normal |
| 업체명 | 16px | bold |
| 상품명 | 14px | normal |
| 금액 | 16px | bold |
| 날짜 | 12px | normal |
| 버튼 텍스트 | 13px | semibold |

### 간격
| 요소 | 값 |
|------|-----|
| 헤더 패딩 | 20px 좌우, 50px 상단, 15px 하단 |
| 카드 패딩 | 16px |
| 카드 간격 | 12px (marginBottom) |
| 카드 borderRadius | 12px |
| 썸네일과 텍스트 간격 | 12px |

---

## 5. 상태별 UI

### 5.1 로딩 상태
- 중앙에 ActivityIndicator 표시
- 색상: #00D563

### 5.2 빈 상태
```
+--------------------------------------------------+
|                                                  |
|                  [쇼핑백 아이콘]                   |
|                                                  |
|              구매 내역이 없습니다                  |
|                                                  |
|        상품을 픽업하면 여기에 표시됩니다            |
|                                                  |
+--------------------------------------------------+
```

### 5.3 에러 상태
- 에러 메시지 표시
- "다시 시도" 버튼

---

## 6. 인터랙션 정의

### 업체명 클릭
- 동작: 해당 업체 상세페이지로 이동
- 스타일: 클릭 시 opacity 변화

### 리뷰 작성 버튼 클릭
- 동작: ReviewScreen으로 이동
- 조건: 해당 예약에 리뷰가 없을 때만 활성화

### 스크롤
- FlatList 사용
- 당겨서 새로고침 (Pull to Refresh)

### 카드 클릭
- 동작: 해당 업체 상세페이지로 이동 (업체명 클릭과 동일)

---

## 7. 데이터 조회 쿼리

```typescript
// Supabase 쿼리
const { data, error } = await supabase
  .from('reservations')
  .select(`
    id,
    reservation_number,
    quantity,
    total_amount,
    pickup_time,
    picked_up_at,
    store_id,
    stores (id, name, image_url),
    products (id, name),
    reviews (id)
  `)
  .eq('consumer_id', consumerId)
  .eq('picked_up', true)
  .order('picked_up_at', { ascending: false });
```

---

## 8. 네비게이션 연동

### App.tsx 수정사항
1. `consumerScreen` 타입에 `'purchasehistory'` 추가
2. MyPageScreen의 `onViewReservations` -> `onViewPurchaseHistory` 변경
3. PurchaseHistoryScreen import 및 라우팅 추가

### navigationStore.ts 수정사항
- ConsumerScreen 타입에 `'purchasehistory'` 추가

---

## 9. 파일 구조

```
app/src/screens/
  PurchaseHistoryScreen.tsx  (신규 생성)
```

---

## 10. 접근성

- 터치 타겟 최소 44x44px
- 색상 대비 충분히 확보 (WCAG 2.1 AA 기준)
- 스크린 리더 지원을 위한 accessibilityLabel 추가
