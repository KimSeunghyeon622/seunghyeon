-- =====================================================
-- 업체 영업 상태 관리 기능 추가
-- =====================================================
-- 이 스크립트는 업체의 영업 상태를 관리하는 기능을 추가합니다.
-- "준비중" 상태 표시를 위한 컬럼 추가
-- =====================================================

-- 1단계: stores 테이블에 영업 상태 컬럼 추가
-- =====================================================

-- 영업 중 여부 (업주가 수동으로 ON/OFF 가능)
ALTER TABLE stores
ADD COLUMN IF NOT EXISTS is_open BOOLEAN DEFAULT true;

-- 2단계: 기존 데이터 업데이트
-- =====================================================

-- 기존 업체는 모두 영업 중으로 설정
UPDATE stores
SET is_open = true
WHERE is_open IS NULL;

-- 3단계: 코멘트 추가 (문서화)
-- =====================================================

COMMENT ON COLUMN stores.is_open IS '영업 중 여부 (true: 영업중, false: 영업종료/휴무)';

-- 4단계: 준비중 상태를 확인하는 뷰 생성 (선택사항)
-- =====================================================

-- 준비중 상태인 업체를 쉽게 확인할 수 있는 뷰
CREATE OR REPLACE VIEW stores_with_status AS
SELECT
  s.*,
  CASE
    WHEN s.cash_balance <= 10000 THEN 'no_cash'
    WHEN s.is_open = false THEN 'closed'
    ELSE 'open'
  END as display_status
FROM stores s;

COMMENT ON VIEW stores_with_status IS '업체 상태를 포함한 뷰 (open: 영업중, closed: 영업종료, no_cash: 캐시부족)';

-- =====================================================
-- 완료!
-- =====================================================
-- 준비중 상태 조건:
-- 1. cash_balance <= 10,000원
-- 2. is_open = false
-- 3. 현재 시간이 영업시간 외 (향후 구현)
-- =====================================================
